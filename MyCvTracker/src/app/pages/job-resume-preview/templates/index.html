<section
  id="job-resume-preview-page"
  ng-controller="JobResumePreviewCtrl">
  <div class="body-section">
    <div class="section-content">
      <div
        class="section-title"
        ng-if="resumePreview.tokenValid === true">
        <h4
          ng-bind="jobDetail.jobTitle"
          ng-if="!!jobDetail.jobTitle"></h4>
        <div
          class="location"
          ng-if="!!jobDetail.jobLocation">
          Location: {{ jobDetail.jobLocation }}
        </div>
      </div>

      <div
        class="resume-preview-iframe"
        ng-style="{ height: (resumePreview.pdfViewerHeight + 'px') }">
        <iframe
          ng-src="{{ trustSrc(resumePreview.url, resumePreview.urlCdt) }}"
          width="100%"
          height="100%"></iframe>
      </div>

      <!--      <div id="pdf-viewer">-->
      <!--        <div class="pdf-viewer-container">-->
      <!--          <div class="page-viewer"></div>-->
      <!--        </div>-->
      <!--      </div>-->

      <!--      <div id="viewerContainer">-->
      <!--        <div id="viewer" class="pdfViewer"></div>-->
      <!--      </div>-->
      <div
        ng-if="!!jobDetail.isExtend"
        class="writing-review extend-preview">
        <div class="writing-panel">
          <div ng-if="!extendForm.submitted && !extendForm.failed">
            <div class="text-primary">
              Would you like to extend this resume preview?
            </div>
            <br />
            <div>
              <button
                ng-disabled="extendForm.submitting"
                class="btn btn-primary"
                ng-click="extendPreview()">
                {{ !extendForm.submitting ? "Extend" : "Extending..." }}
              </button>
            </div>
          </div>
          <div ng-if="extendForm.submitted">
            <div class="text-success">
              Your preview has been extended successfully.
              <br />
              Let share your resume preview to get more reviews.
            </div>
          </div>
          <div ng-if="extendForm.failed">
            <div class="text-error">
              Extending the resume preview has failed due to some reasons.
              <br />
              Please contact us for more information.
            </div>
          </div>
        </div>
      </div>

      <div class="writing-review">
        <div class="writing-panel">
          <div class="panel-title">
            Resume masking
          </div>
          <div class="review-form">
            <div class="form-row">
              <input
                ng-disabled="maskingForm.submitting"
                ng-model="maskingForm.texts"
                class="form-control"
                type="text"
                placeholder="Enter texts you want to mask" />
            </div>
            <div class="form-row">
              <button
                ng-disabled="maskingForm.submitting"
                ng-click="maskText()"
                type="button"
                class="btn btn-primary">
                {{ !!maskingForm.submitting ? "Masking Resume..." : "Mask Resume" }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div
        class="writing-review"
        ng-if="resumePreview.tokenValid === true && !jobDetail.isExtend && !resumePreview.withReviewToken">
        <div class="writing-panel">
          <div class="panel-title">
            Leave a review
          </div>
          <div
            class="review-form"
            ng-if="!writingForm.submitted && !writingForm.expired">
            <div class="form-row">
              <input
                ng-disabled="writingForm.submitting || writingForm.inAuth"
                ng-model="writingForm.email"
                class="form-control"
                type="text"
                placeholder="Enter your email" />
            </div>
            <div class="form-row">
              <textarea
                maxlength="500"
                ng-disabled="writingForm.submitting"
                ng-model="writingForm.content"
                class="form-control"
                placeholder="Enter your review"></textarea>
            </div>
            <div
              class="form-row"
              ng-if="writingForm.emailInvalid || writingForm.contentInvalid">
              <div
                class="text-danger"
                ng-if="writingForm.emailInvalid">
                Email is invalid.
              </div>
              <div
                class="text-danger"
                ng-if="writingForm.contentInvalid">
                Review content is required.
              </div>
            </div>
            <div class="form-row">
              <button
                ng-disabled="writingForm.submitting"
                type="button"
                class="btn btn-primary"
                ng-click="submitReview()">
                {{ !writingForm.submitting ? "Submit My Review" : "Submitting In Progress" }}
              </button>
            </div>
          </div>
          <div
            class="writing-notify-message"
            ng-if="writingForm.submitted || writingForm.expired">
            <div
              class="text-danger"
              ng-if="writingForm.expired">
              Access token has recently expired. Please ask for new access link to review.
            </div>
            <div
              class="text-success"
              ng-if="writingForm.submitted">
              Your review has been submitted successfully. Thanks for your contribution.
            </div>
          </div>
        </div>
      </div>

      <div
        class="list-reviews"
        ng-if="resumePreview.tokenValid === true">
        <div class="reviews-panel">
          <div class="panel-title">
            List of reviews ({{ resumePreview.noOfReviews }})
          </div>

          <div class="panel-content">
            <div
              class="login-asking"
              ng-if="resumePreview.rqUserId <= 0 && (!resumePreview.withReviewToken || !!resumePreview.reviewTokenExpired)">
              <div
                ng-if="!!resumePreview.reviewTokenExpired"
                class="text-danger">
                Review access token has expired.
              </div>
              <br />
              <div>
                Please
                <a ng-href="/login?redirect={{ resumePreview.loginRedirect }}">sign in</a>
                to see your reviews.
              </div>
            </div>
            <div
              class="no-review-notify"
              ng-if="resumePreview.rqUserId > 0 && listReviews.length === 0 && resumePreview.noOfReviews > 0">
              You have no reviews on this resume yet.
            </div>
            <div
              class="no-review-notify"
              ng-if="resumePreview.rqUserId > 0 && listReviews.length === 0 && resumePreview.noOfReviews === 0">
              There is no reviews yet.
            </div>
            <div
              class="reviews"
              ng-if="listReviews.length > 0">
              <div
                ng-repeat="aReview in listReviews track by aReview.id"
                class="a-review">
                <div class="review-container">
                  <div>
                    <div class="reviewer">
                      <div
                        class="email"
                        ng-bind="aReview.feedbackUserEmail">
                      </div>
                      <div
                        class="datetime"
                        ng-bind="formatDateTime(aReview.uploadedAt)">
                      </div>
                    </div>

                    <div class="review-content">
                      <p ng-bind="aReview.resumeReview">
                      </p>
                    </div>

                    <div class="reply-summary">
                      <i class="fas fa-level-up-alt"></i>
                      <span
                        class="text"
                        ng-click="activeReply(aReview)">{{ !!aReview.noOfReply ? aReview.noOfReply : 0 }} comments - Reply</span>
                    </div>
                  </div>
                  <div
                    class="list-reply"
                    ng-if="!!aReview.replyActive">
                    <div
                      class="a-reply reply-comment"
                      ng-repeat="aComment in aReview.listReply track by aComment.id">
                      <div
                        class="user"
                        ng-bind="aComment.userId !== resumePreview.rqUserId ? aComment.userEmail : 'You'"></div>
                      <div
                        class="content"
                        ng-bind="aComment.replyContent"></div>
                      <div
                        class="date"
                        ng-bind="formatDateTime(aComment.uploadedAt)"></div>
                    </div>
                    <div
                      class="a-reply reply-input"
                      ng-if="!!resumePreview.withReviewToken || !resumePreview.isAdminUser">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Enter to leave comment"
                        ng-keydown="$event.keyCode === 13 && writeReviewComment(aReview)"
                        ng-model="aReview.replyContent" />
                      <div
                        class="send-btn"
                        ng-click="writeReviewComment(aReview)">
                        <a href="#">Send</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="text-danger token-error"
        ng-if="resumePreview.tokenValid === false">
        Access token has been expired.
      </div>
    </div>
  </div>
</section>
